(this["webpackJsonpraster-layer-example"]=this["webpackJsonpraster-layer-example"]||[]).push([[0],{132:function(e,t){},133:function(e,t){},168:function(e,t,a){e.exports=a(181)},173:function(e,t,a){},177:function(e,t){},181:function(e,t,a){"use strict";a.r(t);var n,r=a(36),o=a.n(r),i=a(148),s=a.n(i),c=(a(173),a(45)),l=a.n(c),u=a(70),m=a(157),p=a(2),g=a(1),d=a(109),f=a(9),h=a(201),v=a(208),b=a(200),_=a(20),y=a(6),x=a(29),O=a(90),T=a(207),E=a(143),C=a(145),j=a(155),R=a(0),w=a(88),A=a(76),L=a.n(A),D=a(153),S=a.n(D),k=(n={},Object(R.a)(n,L.a.TEXTURE_MIN_FILTER,L.a.NEAREST),Object(R.a)(n,L.a.TEXTURE_MAG_FILTER,L.a.NEAREST),Object(R.a)(n,L.a.TEXTURE_WRAP_S,L.a.CLAMP_TO_EDGE),Object(R.a)(n,L.a.TEXTURE_WRAP_T,L.a.CLAMP_TO_EDGE),n);function P(e,t){return t instanceof w.a?t:t?new w.a(e,Object(O.a)({parameters:k},t)):void 0}var M=Object(O.a)({},T.a.defaultProps,{modules:{type:"array",value:[],compare:!0},images:{type:"object",value:{},compare:!0},moduleProps:{type:"object",value:{},compare:!0}}),G=function(e){Object(f.a)(a,e);var t=Object(d.a)(a);function a(){return Object(p.a)(this,a),t.apply(this,arguments)}return Object(g.a)(a,[{key:"initializeState",value:function(){var e=this.context.gl,t=j.a.getDefaultProgramManager(e),n="fs:DECKGL_MUTATE_COLOR(inout vec4 image, in vec2 coord)",r="fs:DECKGL_CREATE_COLOR(inout vec4 image, in vec2 coord)";t._hookFunctions.includes(n)||t.addShaderHook(n),t._hookFunctions.includes(r)||t.addShaderHook(r),this.setState({images:{}}),Object(x.a)(Object(y.a)(a.prototype),"initializeState",this).call(this)}},{key:"draw",value:function(e){var t=e.uniforms,a=this.state,n=a.model,r=a.images,o=this.props,i=o.desaturate,s=o.transparentColor,c=o.tintColor,l=o.moduleProps;n&&r&&0!==Object.keys(r).length&&Object.values(r).every((function(e){return e}))&&n.setUniforms(Object.assign({},t,{desaturate:i,transparentColor:s.map((function(e){return e/255})),tintColor:c.slice(0,3).map((function(e){return e/255}))})).updateModuleSettings(Object(O.a)({},l,{},r)).draw()}},{key:"getShaders",value:function(){var e=this.props.modules;return Object(O.a)({},Object(x.a)(Object(y.a)(a.prototype),"getShaders",this).call(this),{},{fs:"\n#define SHADER_NAME raster-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec2 vTexCoord;\n\nuniform float desaturate;\nuniform vec4 transparentColor;\nuniform vec3 tintColor;\nuniform float opacity;\n\n// apply desaturation\nvec3 color_desaturate(vec3 color) {\n  float luminance = (color.r + color.g + color.b) * 0.333333333;\n  return mix(color, vec3(luminance), desaturate);\n}\n\n// apply tint\nvec3 color_tint(vec3 color) {\n  return color * tintColor;\n}\n\n// blend with background color\nvec4 apply_opacity(vec3 color, float alpha) {\n  return mix(transparentColor, vec4(color, 1.0), alpha);\n}\n\nvoid main(void) {\n  vec4 image;\n  DECKGL_CREATE_COLOR(image, vTexCoord);\n\n  DECKGL_MUTATE_COLOR(image, vTexCoord);\n\n  gl_FragColor = apply_opacity(color_tint(color_desaturate(image.rgb)), opacity);\n\n  geometry.uv = vTexCoord;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[E.a,C.a].concat(Object(_.a)(e))})}},{key:"updateState",value:function(e){var t=e.props,a=e.oldProps;if(e.changeFlags.extensionsChanged){var n=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(n)}),this.getAttributeManager().invalidateAll()}t&&t.images&&this.updateImages({props:t,oldProps:a});var r=this.getAttributeManager();if(t.bounds!==a.bounds){var o=this.state.mesh,i=this._createMesh();for(var s in this.state.model.setVertexCount(i.vertexCount),i)o&&o[s]!==i[s]&&r.invalidate(s);this.setState({mesh:i})}}},{key:"updateImages",value:function(e){var t=e.props,a=e.oldProps,n=this.state.images,r=function(e){var t=e.gl,a=e.images,n=e.props,r=e.oldProps,o=!1;if(r&&r.images)for(var i in r.images)n.images&&!(i in n.images)&&i in a&&(delete a[i],o=!0);var s=[];for(var c in n.images)!r.images||r.images&&!(c in r.images)?s.push(c):S()(n.images[c],r.images[c])||s.push(c);for(var l=0,u=s;l<u.length;l++){var m=u[l],p=n.images[m];p&&(Array.isArray(p)?a[m]=p.map((function(e){return P(t,e)})):a[m]=P(t,p),o=!0)}return o?a:null}({gl:this.context.gl,images:n,props:t,oldProps:a});r&&this.setState({images:r})}},{key:"finalizeState",value:function(){if(Object(x.a)(Object(y.a)(a.prototype),"finalizeState",this).call(this),this.state.images)for(var e=0,t=Object.values(this.state.images);e<t.length;e++){var n=t[e];Array.isArray(n)?n.map((function(e){return e.delete()})):n.delete()}}}]),a}(T.a);G.defaultProps=M,G.layerName="RasterLayer";var U=a(13);var z={name:"combine-bands",fs:"uniform sampler2D bitmapTexture_r;\nuniform sampler2D bitmapTexture_g;\nuniform sampler2D bitmapTexture_b;\nuniform sampler2D bitmapTexture_a;\n",getUniforms:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.imageBands;if(t&&0!==t.length){var a=Object(U.a)(t,4),n=a[0],r=a[1],o=a[2],i=a[3];return{bitmapTexture_r:n,bitmapTexture_g:r,bitmapTexture_b:o,bitmapTexture_a:i}}},inject:{"fs:DECKGL_CREATE_COLOR":"\n    float r_band = texture2D(bitmapTexture_r, coord).r;\n    float g_band = texture2D(bitmapTexture_g, coord).r;\n    float b_band = texture2D(bitmapTexture_b, coord).r;\n    float a_band = texture2D(bitmapTexture_a, coord).r;\n\n    image = vec4(r_band, g_band, b_band, a_band);\n    "}},B={name:"normalized_difference",fs:"// Calculate standard normalized difference\nfloat normalized_difference_calc(vec4 image) {\n  return ((image.r - image.g) / (image.r + image.g));\n}\n",inject:{"fs:DECKGL_MUTATE_COLOR":"\n    image = vec4(normalized_difference_calc(image), 0., 0., 0.);\n    "}};var K={name:"pansharpen_brovey",fs:"uniform sampler2D bitmapTexture_pan;\nuniform float panWeight;\n\n// calculate pansharpen ratio\nfloat pansharpen_brovey_ratio(vec4 rgb, float pan, float weight) {\n    return pan / ((rgb.r + rgb.g + rgb.b * weight) / (2. + weight));\n}\n\n// Brovey Method: Each resampled, multispectral pixel is\n// multiplied by the ratio of the corresponding\n// panchromatic pixel intensity to the sum of all the\n// multispectral intensities.\n// Original code from https://github.com/mapbox/rio-pansharpen\nvec4 pansharpen_brovey_calc(vec4 rgb, float pan, float weight) {\n    float ratio = pansharpen_brovey_ratio(rgb, pan, weight);\n    vec4 alteredRGB = ratio * rgb;\n    return clamp(alteredRGB, 0., 1.);\n}\n",getUniforms:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.imagePan,a=e.panWeight,n=void 0===a?.2:a;if(t)return{bitmapTexture_pan:t,panWeight:n}},inject:{"fs:DECKGL_MUTATE_COLOR":"\n    float pan_band = texture2D(bitmapTexture_pan, coord).r;\n    image = pansharpen_brovey_calc(image, pan_band, panWeight);\n    "}};var F={name:"colormap",fs:"uniform sampler2D bitmapTexture_colormap;\n\n// Apply colormap texture given value\n// Since the texture only varies in the x direction, setting v to 0.5 as a\n// constant is fine\n// Assumes the input range of value is -1 to 1\nvec4 colormap_apply(sampler2D colormap, vec4 image) {\n  vec2 uv = vec2(0.5 * image.r + 0.5, 0.5);\n  return texture2D(colormap, uv);\n}\n",getUniforms:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.imageColormap;if(t)return{bitmapTexture_colormap:t}},inject:{"fs:DECKGL_MUTATE_COLOR":"\n    image = colormap_apply(bitmapTexture_colormap, image);\n    "}},I=a(202),W=a(204),N=a(197),X=a(134),H=a.n(X),J={longitude:-112.1861,latitude:36.1284,zoom:11.5,pitch:0,bearing:0},V="dynamodb://us-west-2/landsat8-2019-spring";function Z(e){var t="RGB".slice(0,e),a="gamma ".concat(t," 3.5, sigmoidal ").concat(t," 15 0.35");return 3===e&&(a+=", saturation 1.7"),a}function $(e){var t=e.bands,a=e.url,n=e.x,r=e.y,o=e.z,i=Array.isArray(t)?t:[t],s={url:a,bands:i.join(","),color_ops:Z(i.length)},c=new URLSearchParams(s),l="https://us-west-2-lambda.kylebarron.dev/landsat/tiles/".concat(o,"/").concat(n,"/").concat(r,".jpg?");return l+=c.toString()}var q=new v.a(N.a,{amount:1}),Q=function(e){Object(f.a)(a,e);var t=Object(d.a)(a);function a(){return Object(p.a)(this,a),t.apply(this,arguments)}return Object(g.a)(a,[{key:"render",value:function(){var e=[new b.a({minZoom:0,maxZoom:12,tileSize:256,getTileData:Y,renderSubLayers:function(e){var t=e.tile.bbox,a=t.west,n=t.south,r=t.east,o=t.north,i=e.data,s=i.modules,c=i.images,l=Object(m.a)(i,["modules","images"]);return new G(e,{images:c,modules:s,moduleProps:l,bounds:[a,n,r,o]})}})];return o.a.createElement(h.a,{initialViewState:J,layers:e,effects:[q],controller:!0})}}]),a}(o.a.Component);function Y(e){return ee.apply(this,arguments)}function ee(){return(ee=Object(u.a)(l.a.mark((function e(t){var a,n,r,o,i,s,c,u,m,p,g,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.x,n=t.y,r=t.z,o=[5,4],i=r>=12&&4===o[0]&&3===o[1]&&2===o[2],!0,"https://cdn.jsdelivr.net/gh/kylebarron/deck.gl-raster/assets/colormaps/cfastie.png",s=[z,B],c=o.map((function(e){return $({x:a,y:n,z:r,bands:e,url:V})})),u=c.map((function(e){return te(e)})),i&&(p=$({x:a,y:n,z:r,bands:8,url:V}),m=te(p),s.push(K)),g=te("https://cdn.jsdelivr.net/gh/kylebarron/deck.gl-raster/assets/colormaps/cfastie.png"),s.push(F),e.next=12,Promise.all([m,u,g]);case 12:return e.next=14,Promise.all(u);case 14:return e.t0=e.sent,e.next=17,g;case 17:return e.t1=e.sent,e.next=20,m;case 20:return e.t2=e.sent,d={imageBands:e.t0,imageColormap:e.t1,imagePan:e.t2},e.abrupt("return",{images:d,modules:s});case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(e){return ae.apply(this,arguments)}function ae(){return(ae=Object(u.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(I.a)(t,W.a);case 2:return a=e.sent,e.abrupt("return",{data:a,format:a&&10===a.height?H.a.RGB:H.a.LUMINANCE});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(Q,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[168,1,2]]]);
//# sourceMappingURL=main.c8266e8e.chunk.js.map