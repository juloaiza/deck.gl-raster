(this["webpackJsonpraster-layer-example"]=this["webpackJsonpraster-layer-example"]||[]).push([[0],{132:function(e,a){},133:function(e,a){},167:function(e,a,t){e.exports=t(180)},172:function(e,a,t){},176:function(e,a){},180:function(e,a,t){"use strict";t.r(a);var n,r=t(36),o=t.n(r),i=t(147),s=t.n(i),c=(t(172),t(45)),l=t.n(c),u=t(71),m=t(156),p=t(2),g=t(1),d=t(109),f=t(9),v=t(200),b=t(207),h=t(199),_=t(20),y=t(6),O=t(29),x=t(90),T=t(206),E=t(142),C=t(144),j=t(154),w=t(0),R=t(88),L=t(56),A=t.n(L),D=t(152),S=t.n(D),k=(n={},Object(w.a)(n,A.a.TEXTURE_MIN_FILTER,A.a.NEAREST),Object(w.a)(n,A.a.TEXTURE_MAG_FILTER,A.a.NEAREST),Object(w.a)(n,A.a.TEXTURE_WRAP_S,A.a.CLAMP_TO_EDGE),Object(w.a)(n,A.a.TEXTURE_WRAP_T,A.a.CLAMP_TO_EDGE),n);function P(e,a){return a instanceof R.a?a:a?new R.a(e,Object(x.a)({parameters:k},a)):void 0}var M=Object(x.a)({},T.a.defaultProps,{modules:{type:"array",value:[],compare:!0},images:{type:"object",value:{},compare:!0},moduleProps:{type:"object",value:{},compare:!0}}),G=function(e){Object(f.a)(t,e);var a=Object(d.a)(t);function t(){return Object(p.a)(this,t),a.apply(this,arguments)}return Object(g.a)(t,[{key:"initializeState",value:function(){var e=this.context.gl,a=j.a.getDefaultProgramManager(e),n="fs:DECKGL_MUTATE_COLOR(inout vec4 image, in vec2 coord)",r="fs:DECKGL_CREATE_COLOR(inout vec4 image, in vec2 coord)";a._hookFunctions.includes(n)||a.addShaderHook(n),a._hookFunctions.includes(r)||a.addShaderHook(r),this.setState({images:{}}),Object(O.a)(Object(y.a)(t.prototype),"initializeState",this).call(this)}},{key:"draw",value:function(e){var a=e.uniforms,t=this.state,n=t.model,r=t.images,o=this.props,i=o.desaturate,s=o.transparentColor,c=o.tintColor,l=o.moduleProps;n&&r&&0!==Object.keys(r).length&&Object.values(r).every((function(e){return e}))&&n.setUniforms(Object.assign({},a,{desaturate:i,transparentColor:s.map((function(e){return e/255})),tintColor:c.slice(0,3).map((function(e){return e/255}))})).updateModuleSettings(Object(x.a)({},l,{},r)).draw()}},{key:"getShaders",value:function(){var e=this.props.modules;return Object(x.a)({},Object(O.a)(Object(y.a)(t.prototype),"getShaders",this).call(this),{},{fs:"\n#define SHADER_NAME raster-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec2 vTexCoord;\n\nuniform float desaturate;\nuniform vec4 transparentColor;\nuniform vec3 tintColor;\nuniform float opacity;\n\n// apply desaturation\nvec3 color_desaturate(vec3 color) {\n  float luminance = (color.r + color.g + color.b) * 0.333333333;\n  return mix(color, vec3(luminance), desaturate);\n}\n\n// apply tint\nvec3 color_tint(vec3 color) {\n  return color * tintColor;\n}\n\n// blend with background color\nvec4 apply_opacity(vec3 color, float alpha) {\n  return mix(transparentColor, vec4(color, 1.0), alpha);\n}\n\nvoid main(void) {\n  vec4 image;\n  DECKGL_CREATE_COLOR(image, vTexCoord);\n\n  DECKGL_MUTATE_COLOR(image, vTexCoord);\n\n  gl_FragColor = apply_opacity(color_tint(color_desaturate(image.rgb)), opacity);\n\n  geometry.uv = vTexCoord;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[E.a,C.a].concat(Object(_.a)(e))})}},{key:"updateState",value:function(e){var a=e.props,t=e.oldProps;if(e.changeFlags.extensionsChanged){var n=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(n)}),this.getAttributeManager().invalidateAll()}a&&a.images&&this.updateImages({props:a,oldProps:t});var r=this.getAttributeManager();if(a.bounds!==t.bounds){var o=this.state.mesh,i=this._createMesh();for(var s in this.state.model.setVertexCount(i.vertexCount),i)o&&o[s]!==i[s]&&r.invalidate(s);this.setState({mesh:i})}}},{key:"updateImages",value:function(e){var a=e.props,t=e.oldProps,n=this.state.images,r=function(e){var a=e.gl,t=e.images,n=e.props,r=e.oldProps,o=!1;if(r&&r.images)for(var i in r.images)n.images&&!(i in n.images)&&i in t&&(delete t[i],o=!0);var s=[];for(var c in n.images)!r.images||r.images&&!(c in r.images)?s.push(c):S()(n.images[c],r.images[c])||s.push(c);for(var l=0,u=s;l<u.length;l++){var m=u[l],p=n.images[m];p&&(Array.isArray(p)?t[m]=p.map((function(e){return P(a,e)})):t[m]=P(a,p),o=!0)}return o?t:null}({gl:this.context.gl,images:n,props:a,oldProps:t});r&&this.setState({images:r})}},{key:"finalizeState",value:function(){if(Object(O.a)(Object(y.a)(t.prototype),"finalizeState",this).call(this),this.state.images)for(var e=0,a=Object.values(this.state.images);e<a.length;e++){var n=a[e];Array.isArray(n)?n.map((function(e){return e.delete()})):n.delete()}}}]),t}(T.a);G.defaultProps=M,G.layerName="RasterLayer";var U=t(13);var z={name:"combine-bands",fs:"uniform sampler2D bitmapTexture_r;\nuniform sampler2D bitmapTexture_g;\nuniform sampler2D bitmapTexture_b;\nuniform sampler2D bitmapTexture_a;\n",getUniforms:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=e.imageBands;if(a&&0!==a.length){var t=Object(U.a)(a,4),n=t[0],r=t[1],o=t[2],i=t[3];return{bitmapTexture_r:n,bitmapTexture_g:r,bitmapTexture_b:o,bitmapTexture_a:i}}},inject:{"fs:DECKGL_CREATE_COLOR":"\n    float r_band = texture2D(bitmapTexture_r, coord).r;\n    float g_band = texture2D(bitmapTexture_g, coord).r;\n    float b_band = texture2D(bitmapTexture_b, coord).r;\n    float a_band = texture2D(bitmapTexture_a, coord).r;\n\n    image = vec4(r_band, g_band, b_band, a_band);\n    "}},B={name:"normalized_difference",fs:"float normalized_difference_calc(vec4 image) {\n  return ((image.r - image.g) / (image.r + image.g));\n}\n",inject:{"fs:DECKGL_MUTATE_COLOR":"\n    image = vec4(normalized_difference_calc(image), 0., 0., 0.);\n    "}};var K={name:"pansharpen_brovey",fs:"uniform sampler2D bitmapTexture_pan;\nuniform float panWeight;\n\nfloat pansharpen_brovey_ratio(vec4 rgb, float pan, float weight) {\n    return pan / ((rgb.r + rgb.g + rgb.b * weight) / (2. + weight));\n}\n\nvec4 pansharpen_brovey_calc(vec4 rgb, float pan, float weight) {\n    float ratio = pansharpen_brovey_ratio(rgb, pan, weight);\n    vec4 alteredRGB = ratio * rgb;\n    return clamp(alteredRGB, 0., 1.);\n}\n",getUniforms:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=e.imagePan,t=e.panWeight,n=void 0===t?.2:t;if(a)return{bitmapTexture_pan:a,panWeight:n}},inject:{"fs:DECKGL_MUTATE_COLOR":"\n    float pan_band = texture2D(bitmapTexture_pan, coord).r;\n    image = pansharpen_brovey_calc(image, pan_band, panWeight);\n    "}};var F={name:"colormap",fs:"uniform sampler2D bitmapTexture_colormap;\n\nvec4 colormap_apply(sampler2D colormap, vec4 image) {\n  vec2 uv = vec2(0.5 * image.r + 0.5, 0.5);\n  return texture2D(colormap, uv);\n}\n",getUniforms:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=e.imageColormap;if(a)return{bitmapTexture_colormap:a}},inject:{"fs:DECKGL_MUTATE_COLOR":"\n    image = colormap_apply(bitmapTexture_colormap, image);\n    "}},I=t(201),W=t(203),N=t(196),X={longitude:-112.1861,latitude:36.1284,zoom:11.5,pitch:0,bearing:0,minZoom:6},H="dynamodb://us-west-2/landsat8-2019-spring";function Z(e){var a="RGB".slice(0,e),t="gamma ".concat(a," 3.5, sigmoidal ").concat(a," 15 0.35");return 3===e&&(t+=", saturation 1.7"),t}function J(e){var a=e.bands,t=e.url,n=e.x,r=e.y,o=e.z,i=Array.isArray(a)?a:[a],s={url:t,bands:i.join(","),color_ops:Z(i.length)},c=new URLSearchParams(s),l="https://us-west-2-lambda.kylebarron.dev/landsat/tiles/".concat(o,"/").concat(n,"/").concat(r,".jpg?");return l+=c.toString()}var V=new b.a(N.a,{amount:1}),$=function(e){Object(f.a)(t,e);var a=Object(d.a)(t);function t(){return Object(p.a)(this,t),a.apply(this,arguments)}return Object(g.a)(t,[{key:"render",value:function(){var e=[new h.a({minZoom:7,maxZoom:12,tileSize:256,getTileData:q,renderSubLayers:function(e){var a=e.tile.bbox,t=a.west,n=a.south,r=a.east,o=a.north,i=e.data,s=i.modules,c=i.images,l=Object(m.a)(i,["modules","images"]);return new G(e,{images:c,modules:s,moduleProps:l,bounds:[t,n,r,o]})}})];return o.a.createElement(v.a,{initialViewState:X,layers:e,effects:[V],controller:!0,glOptions:{powerPreference:"high-performance"}})}}]),t}(o.a.Component);function q(e){return Q.apply(this,arguments)}function Q(){return(Q=Object(u.a)(l.a.mark((function e(a){var t,n,r,o,i,s,c,u,m,p,g,d,f,v,b;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.x,n=a.y,r=a.z,o=a.landsatBands,i=void 0===o?[5,4]:o,s=a.useColormap,c=void 0===s||s,u=r>=12&&4===i[0]&&3===i[1]&&2===i[2],"https://cdn.jsdelivr.net/gh/kylebarron/deck.gl-raster/assets/colormaps/cfastie.png",m=[z,B],p=i.map((function(e){return J({x:t,y:n,z:r,bands:e,url:H})})),g=p.map((function(e){return Y(e)})),u&&(f=J({x:t,y:n,z:r,bands:8,url:H}),d=Y(f),m.push(K)),c&&(v=Y("https://cdn.jsdelivr.net/gh/kylebarron/deck.gl-raster/assets/colormaps/cfastie.png"),m.push(F)),e.next=10,Promise.all([d,g,v]);case 10:return e.next=12,Promise.all(g);case 12:return e.t0=e.sent,e.next=15,v;case 15:return e.t1=e.sent,e.next=18,d;case 18:return e.t2=e.sent,b={imageBands:e.t0,imageColormap:e.t1,imagePan:e.t2},e.abrupt("return",{images:b,modules:m});case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e){return ee.apply(this,arguments)}function ee(){return(ee=Object(u.a)(l.a.mark((function e(a){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(I.a)(a,W.a);case 2:return t=e.sent,e.abrupt("return",{data:t,format:t&&10===t.height?A.a.RGB:A.a.LUMINANCE});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement($,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[167,1,2]]]);
//# sourceMappingURL=main.11ed7ba2.chunk.js.map