(this["webpackJsonpraster-mesh-layer-example"]=this["webpackJsonpraster-mesh-layer-example"]||[]).push([[0],{113:function(e,t){},145:function(e,t,a){e.exports=a(158)},150:function(e,t,a){},151:function(e,t){},158:function(e,t,a){"use strict";a.r(t);var n=a(25),r=a.n(n),o=a(128),i=a.n(o),s=(a(150),a(2)),c=a(1),l=a(93),m=a(5),u=a(175),p=a(22),d=a.n(p),g=a(33),h=a(115),f=a.n(h),v=a(13),b=a(129),_=a(177),y=a(178),x=a(179),O=a(176),T=a(11),E=a(7);var S={name:"combine-bands",fs:"uniform sampler2D bitmapTexture_r;\nuniform sampler2D bitmapTexture_g;\nuniform sampler2D bitmapTexture_b;\nuniform sampler2D bitmapTexture_a;\n",getUniforms:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.imageBands;if(t&&0!==t.length){var a=Object(E.a)(t,4),n=a[0],r=a[1],o=a[2],i=a[3];return{bitmapTexture_r:n,bitmapTexture_g:r,bitmapTexture_b:o,bitmapTexture_a:i}}},inject:{"fs:DECKGL_CREATE_COLOR":"\n    float r_band = texture2D(bitmapTexture_r, coord).r;\n    float g_band = texture2D(bitmapTexture_g, coord).r;\n    float b_band = texture2D(bitmapTexture_b, coord).r;\n    float a_band = texture2D(bitmapTexture_a, coord).r;\n\n    image = vec4(r_band, g_band, b_band, a_band);\n    "}},j={name:"normalized_difference",fs:"// Calculate standard normalized difference\nfloat normalized_difference_calc(vec4 image) {\n  return ((image.r - image.g) / (image.r + image.g));\n}\n",inject:{"fs:DECKGL_MUTATE_COLOR":"\n    image = vec4(normalized_difference_calc(image), 0., 0., 0.);\n    "}};var C={name:"pansharpen_brovey",fs:"uniform sampler2D bitmapTexture_pan;\nuniform float panWeight;\n\n// calculate pansharpen ratio\nfloat pansharpen_brovey_ratio(vec4 rgb, float pan, float weight) {\n    return pan / ((rgb.r + rgb.g + rgb.b * weight) / (2. + weight));\n}\n\n// Brovey Method: Each resampled, multispectral pixel is\n// multiplied by the ratio of the corresponding\n// panchromatic pixel intensity to the sum of all the\n// multispectral intensities.\n// Original code from https://github.com/mapbox/rio-pansharpen\nvec4 pansharpen_brovey_calc(vec4 rgb, float pan, float weight) {\n    float ratio = pansharpen_brovey_ratio(rgb, pan, weight);\n    vec4 alteredRGB = ratio * rgb;\n    return clamp(alteredRGB, 0., 1.);\n}\n",getUniforms:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.imagePan,a=e.panWeight,n=void 0===a?.2:a;if(t)return{bitmapTexture_pan:t,panWeight:n}},inject:{"fs:DECKGL_MUTATE_COLOR":"\n    float pan_band = texture2D(bitmapTexture_pan, coord).r;\n    image = pansharpen_brovey_calc(image, pan_band, panWeight);\n    "}};var w={name:"colormap",fs:"uniform sampler2D bitmapTexture_colormap;\n\n// Apply colormap texture given value\n// Since the texture only varies in the x direction, setting v to 0.5 as a\n// constant is fine\n// Assumes the input range of value is -1 to 1\nvec4 colormap_apply(sampler2D colormap, vec4 image) {\n  vec2 uv = vec2(0.5 * image.r + 0.5, 0.5);\n  return texture2D(colormap, uv);\n}\n",getUniforms:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.imageColormap;if(t)return{bitmapTexture_colormap:t}},inject:{"fs:DECKGL_MUTATE_COLOR":"\n    image = colormap_apply(bitmapTexture_colormap, image);\n    "}},A=a(12),R=a(3),L=a(16),D=a(86),M=a(45),P=a.n(M),k=a(181),z=a(174),I=a(4),G=a(134),N=a(15),U=a(121),F=a(182),B=a(127),K=a(135);function W(e,t){return t===v.a.CARTESIAN||t===v.a.METER_OFFSETS||t===v.a.DEFAULT&&!e.isGeospatial}var Z,V=a(0),X=a(77),H=a(132),q=a.n(H),J=(Z={},Object(V.a)(Z,P.a.TEXTURE_MIN_FILTER,P.a.NEAREST),Object(V.a)(Z,P.a.TEXTURE_MAG_FILTER,P.a.NEAREST),Object(V.a)(Z,P.a.TEXTURE_WRAP_S,P.a.CLAMP_TO_EDGE),Object(V.a)(Z,P.a.TEXTURE_WRAP_T,P.a.CLAMP_TO_EDGE),Z);function $(e,t){return t instanceof X.a?t:t?new X.a(e,Object(D.a)({parameters:J},t)):void 0}function Q(e){N.a.assert(e.positions||e.POSITION,'RasterMeshLayer requires "postions" or "POSITION" attribute in mesh property.')}function Y(e){if(e.attributes)return Q(e.attributes),e instanceof z.a?e:new z.a(e);if(e.positions||e.POSITION)return Q(e),new z.a({attributes:e});throw Error("Invalid mesh")}var ee=Object(D.a)({},k.a.defaultProps,{modules:{type:"array",value:[],compare:!0},images:{type:"object",value:{},compare:!0},moduleProps:{type:"object",value:{},compare:!0}}),te=function(e){Object(m.a)(a,e);var t=Object(l.a)(a);function a(){return Object(s.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"initializeState",value:function(){var e=this.context.gl,t=K.a.getDefaultProgramManager(e),n="fs:DECKGL_MUTATE_COLOR(inout vec4 image, in vec2 coord)",r="fs:DECKGL_CREATE_COLOR(inout vec4 image, in vec2 coord)";t._hookFunctions.includes(n)||t.addShaderHook(n),t._hookFunctions.includes(r)||t.addShaderHook(r),this.setState({images:{}}),Object(L.a)(Object(R.a)(a.prototype),"initializeState",this).call(this)}},{key:"getShaders",value:function(){var e=!Object(I.f)(this.context.gl),t=this.props.modules,n=void 0===t?[]:t;return Object.assign({},Object(L.a)(Object(R.a)(a.prototype),"getShaders",this).call(this),{fs:"#version 300 es\n#define SHADER_NAME raster-mesh-layer-fs\n\nprecision highp float;\n\nuniform bool hasTexture;\n\nuniform bool flatShading;\nuniform float opacity;\n\nin vec2 vTexCoord;\nin vec3 cameraPosition;\nin vec3 normals_commonspace;\nin vec4 position_commonspace;\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  geometry.uv = vTexCoord;\n  vec4 image;\n  DECKGL_CREATE_COLOR(image, vTexCoord);\n\n  DECKGL_MUTATE_COLOR(image, vTexCoord);\n\n  vec3 normal;\n  if (flatShading) {\n\n// NOTE(Tarek): This is necessary because\n// headless.gl reports the extension as\n// available but does not support it in\n// the shader.\n#ifdef DERIVATIVES_AVAILABLE\n    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));\n#else\n    normal = vec3(0.0, 0.0, 1.0);\n#endif\n  } else {\n    normal = normals_commonspace;\n  }\n\n  vec3 lightColor = lighting_getLightColor(image.rgb, cameraPosition, position_commonspace.xyz, normal);\n  fragColor = vec4(lightColor, opacity);\n\n  DECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",transpileToGLSL100:e,modules:[U.a,F.b,B.a].concat(Object(A.a)(n))})}},{key:"updateState",value:function(e){var t=e.props,n=e.oldProps,r=e.changeFlags;if(Object(L.a)(Object(R.a)(a.prototype),"updateState",this).call(this,{props:t,oldProps:n,changeFlags:r}),t.mesh!==n.mesh||r.extensionsChanged||t.modules!==n.modules){if(this.state.model&&this.state.model.delete(),t.mesh){this.setState({model:this.getModel(t.mesh)});var o=t.mesh.attributes||t.mesh;this.setState({hasNormals:Boolean(o.NORMAL||o.normals)})}this.getAttributeManager().invalidateAll()}t&&t.images&&this.updateImages({props:t,oldProps:n}),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?P.a.LINE_STRIP:P.a.TRIANGLES)}},{key:"updateImages",value:function(e){var t=e.props,a=e.oldProps,n=this.state.images,r=function(e){var t=e.gl,a=e.images,n=e.props,r=e.oldProps,o=!1;if(r&&r.images)for(var i in r.images)n.images&&!(i in n.images)&&i in a&&(delete a[i],o=!0);var s=[];for(var c in n.images)!r.images||r.images&&!(c in r.images)?s.push(c):q()(n.images[c],r.images[c])||s.push(c);for(var l=0,m=s;l<m.length;l++){var u=m[l],p=n.images[u];p&&(Array.isArray(p)?a[u]=p.map((function(e){return $(t,e)})):a[u]=$(t,p),o=!0)}return o?a:null}({gl:this.context.gl,images:n,props:t,oldProps:a});r&&this.setState({images:r})}},{key:"draw",value:function(e){var t=e.uniforms,a=this.state,n=a.model,r=a.images,o=this.props.moduleProps;if(n&&r&&0!==Object.keys(r).length&&Object.values(r).every((function(e){return e}))){var i=this.context.viewport,s=this.props,c=s.sizeScale,l=s.coordinateSystem,m=s._instanced;n.setUniforms(Object.assign({},t,{sizeScale:c,composeModelMatrix:!m||W(i,l),flatShading:!this.state.hasNormals})).updateModuleSettings(Object(D.a)({},o,{},r)).draw()}}},{key:"finalizeState",value:function(){if(Object(L.a)(Object(R.a)(a.prototype),"finalizeState",this).call(this),this.state.images)for(var e=0,t=Object.values(this.state.images);e<t.length;e++){var n=t[e];Array.isArray(n)?n.map((function(e){return e.delete()})):n.delete()}}},{key:"getModel",value:function(e){var t=this.context.gl;return new G.a(t,Object.assign({},this.getShaders(),{id:this.props.id,geometry:Y(e),isInstanced:!0}))}}]),a}(k.a);te.layerName="RasterMeshLayer",te.defaultProps=ee;function ae(e){var t="RGB".slice(0,e),a="gamma ".concat(t," 3.5, sigmoidal ").concat(t," 15 0.35");return 3===e&&(a+=", saturation 1.7"),a}function ne(e){var t=e.bands,a=e.url,n=e.x,r=e.y,o=e.z,i=Array.isArray(t)?t:[t],s={url:a,bands:i.join(","),color_ops:ae(i.length)},c=new URLSearchParams(s),l="https://us-west-2-lambda.kylebarron.dev/landsat/tiles/".concat(o,"/").concat(n,"/").concat(r,".jpg?");return l+=c.toString()}function re(e){var t=e.x,a=e.y,n=e.z;return"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png".replace("{x}",t).replace("{y}",a).replace("{z}",n)}var oe={rScaler:256,gScaler:1,bScaler:1/256,offset:-32768};function ie(e){return 77067.34/(1<<e)}Object(b.b)([x.a]);var se=[1];function ce(e){return le.apply(this,arguments)}function le(){return(le=Object(g.a)(d.a.mark((function e(t){var a,n,r,o,i,s,c,l,m,u,p,g,h,f;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.x,n=t.y,r=t.z,o=[5,4],i=r>=12&&4===o[0]&&3===o[1]&&2===o[2],!0,"https://cdn.jsdelivr.net/gh/kylebarron/deck.gl-raster/assets/colormaps/spectral.png",s=[S,j],c=re({x:a,y:n,z:r}),l=pe({terrainImage:c,bounds:[0,1,1,0],elevationDecoder:oe,meshMaxError:ie(r)}),m=o.map((function(e){return ne({x:a,y:n,z:r,bands:e,url:"dynamodb://us-west-2/landsat8-2019-spring"})})),u=m.map((function(e){return de(e)})),i&&(g=ne({x:a,y:n,z:r,bands:8,url:"dynamodb://us-west-2/landsat8-2019-spring"}),p=de(g),s.push(C)),h=de("https://cdn.jsdelivr.net/gh/kylebarron/deck.gl-raster/assets/colormaps/spectral.png"),s.push(w),e.next=15,Promise.all([p,u,h]);case 15:return e.next=17,Promise.all(u);case 17:return e.t0=e.sent,e.next=20,h;case 20:return e.t1=e.sent,e.next=23,p;case 23:return e.t2=e.sent,f={imageBands:e.t0,imageColormap:e.t1,imagePan:e.t2},e.t3=f,e.t4=s,e.next=29,l;case 29:return e.t5=e.sent,e.abrupt("return",{images:e.t3,modules:e.t4,terrain:e.t5});case 31:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function me(e){var t=e.data,a=e.tile;if(!t)return null;var n=t.images,r=t.modules,o=t.terrain;return[new te(e,{data:se,mesh:o,modules:r,images:n,getPolygonOffset:null,coordinateSystem:v.a.CARTESIAN,modelMatrix:ue(a),getPosition:function(e){return[0,0,0]},getColor:[255,255,255]})]}function ue(e){var t=Math.pow(2,e.z),a=512/t,n=-a,r=512*e.x/t,o=512*(1-e.y/t);return(new T.a).translate([r,o,0]).scale([a,n,1])}function pe(e){var t=e.terrainImage,a=e.bounds,n=e.elevationDecoder,r=e.meshMaxError,o=e.workerUrl;if(!t)return null;var i={terrain:{bounds:a,meshMaxError:r,elevationDecoder:n}};return o&&(i.terrain.workerUrl=o),Object(_.a)(t,y.a,i)}function de(e){return ge.apply(this,arguments)}function ge(){return(ge=Object(g.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(_.a)(t,x.a);case 2:return a=e.sent,e.abrupt("return",{data:a,format:a&&10===a.height?f.a.RGB:f.a.LUMINANCE});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var he={latitude:46.21,longitude:-122.18,zoom:11.5,bearing:140,pitch:60,maxPitch:80},fe=function(e){Object(m.a)(a,e);var t=Object(l.a)(a);function a(){return Object(s.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.minZoom,a=void 0===t?0:t,n=e.maxZoom,r=void 0===n?17:n;return new O.a({id:"terrain-tiles",minZoom:a,maxZoom:r,tileSize:256,maxRequests:12,getTileData:ce,renderSubLayers:me})}({minZoom:7,maxZoom:12});return r.a.createElement(u.a,{initialViewState:he,controller:!0,layers:e})}}]),a}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(fe,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[145,1,2]]]);
//# sourceMappingURL=main.1d0f18f3.chunk.js.map