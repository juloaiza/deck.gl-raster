(this["webpackJsonpraster-mesh-layer-example"]=this["webpackJsonpraster-mesh-layer-example"]||[]).push([[0],{113:function(e,a){},144:function(e,a,t){e.exports=t(157)},149:function(e,a,t){},150:function(e,a){},157:function(e,a,t){"use strict";t.r(a);var n=t(25),r=t.n(n),o=t(127),i=t.n(o),s=(t(149),t(2)),c=t(1),l=t(93),m=t(5),u=t(174),p=t(22),d=t.n(p),g=t(33),f=t(37),h=t.n(f),v=t(13),b=t(128),_=t(176),y=t(177),x=t(178),O=t(175),T=t(11),E=t(7);var j={name:"combine-bands",fs:"uniform sampler2D bitmapTexture_r;\nuniform sampler2D bitmapTexture_g;\nuniform sampler2D bitmapTexture_b;\nuniform sampler2D bitmapTexture_a;\n",getUniforms:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=e.imageBands;if(a&&0!==a.length){var t=Object(E.a)(a,4),n=t[0],r=t[1],o=t[2],i=t[3];return{bitmapTexture_r:n,bitmapTexture_g:r,bitmapTexture_b:o,bitmapTexture_a:i}}},inject:{"fs:DECKGL_CREATE_COLOR":"\n    float r_band = texture2D(bitmapTexture_r, coord).r;\n    float g_band = texture2D(bitmapTexture_g, coord).r;\n    float b_band = texture2D(bitmapTexture_b, coord).r;\n    float a_band = texture2D(bitmapTexture_a, coord).r;\n\n    image = vec4(r_band, g_band, b_band, a_band);\n    "}},S={name:"normalized_difference",fs:"float normalized_difference_calc(vec4 image) {\n  return ((image.r - image.g) / (image.r + image.g));\n}\n",inject:{"fs:DECKGL_MUTATE_COLOR":"\n    image = vec4(normalized_difference_calc(image), 0., 0., 0.);\n    "}};var C={name:"pansharpen_brovey",fs:"uniform sampler2D bitmapTexture_pan;\nuniform float panWeight;\n\nfloat pansharpen_brovey_ratio(vec4 rgb, float pan, float weight) {\n    return pan / ((rgb.r + rgb.g + rgb.b * weight) / (2. + weight));\n}\n\nvec4 pansharpen_brovey_calc(vec4 rgb, float pan, float weight) {\n    float ratio = pansharpen_brovey_ratio(rgb, pan, weight);\n    vec4 alteredRGB = ratio * rgb;\n    return clamp(alteredRGB, 0., 1.);\n}\n",getUniforms:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=e.imagePan,t=e.panWeight,n=void 0===t?.2:t;if(a)return{bitmapTexture_pan:a,panWeight:n}},inject:{"fs:DECKGL_MUTATE_COLOR":"\n    float pan_band = texture2D(bitmapTexture_pan, coord).r;\n    image = pansharpen_brovey_calc(image, pan_band, panWeight);\n    "}};var w={name:"colormap",fs:"uniform sampler2D bitmapTexture_colormap;\n\nvec4 colormap_apply(sampler2D colormap, vec4 image) {\n  vec2 uv = vec2(0.5 * image.r + 0.5, 0.5);\n  return texture2D(colormap, uv);\n}\n",getUniforms:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=e.imageColormap;if(a)return{bitmapTexture_colormap:a}},inject:{"fs:DECKGL_MUTATE_COLOR":"\n    image = colormap_apply(bitmapTexture_colormap, image);\n    "}},R=t(12),A=t(3),L=t(16),D=t(86),P=t(180),M=t(173),k=t(4),I=t(133),z=t(15),G=t(120),N=t(181),U=t(126),F=t(134);function B(e,a){return a===v.a.CARTESIAN||a===v.a.METER_OFFSETS||a===v.a.DEFAULT&&!e.isGeospatial}var K,W=t(0),Z=t(77),V=t(131),X=t.n(V),H=(K={},Object(W.a)(K,h.a.TEXTURE_MIN_FILTER,h.a.NEAREST),Object(W.a)(K,h.a.TEXTURE_MAG_FILTER,h.a.NEAREST),Object(W.a)(K,h.a.TEXTURE_WRAP_S,h.a.CLAMP_TO_EDGE),Object(W.a)(K,h.a.TEXTURE_WRAP_T,h.a.CLAMP_TO_EDGE),K);function q(e,a){return a instanceof Z.a?a:a?new Z.a(e,Object(D.a)({parameters:H},a)):void 0}function J(e){z.a.assert(e.positions||e.POSITION,'RasterMeshLayer requires "postions" or "POSITION" attribute in mesh property.')}function $(e){if(e.attributes)return J(e.attributes),e instanceof M.a?e:new M.a(e);if(e.positions||e.POSITION)return J(e),new M.a({attributes:e});throw Error("Invalid mesh")}var Q=Object(D.a)({},P.a.defaultProps,{modules:{type:"array",value:[],compare:!0},images:{type:"object",value:{},compare:!0},moduleProps:{type:"object",value:{},compare:!0}}),Y=function(e){Object(m.a)(t,e);var a=Object(l.a)(t);function t(){return Object(s.a)(this,t),a.apply(this,arguments)}return Object(c.a)(t,[{key:"initializeState",value:function(){var e=this.context.gl,a=F.a.getDefaultProgramManager(e),n="fs:DECKGL_MUTATE_COLOR(inout vec4 image, in vec2 coord)",r="fs:DECKGL_CREATE_COLOR(inout vec4 image, in vec2 coord)";a._hookFunctions.includes(n)||a.addShaderHook(n),a._hookFunctions.includes(r)||a.addShaderHook(r),this.setState({images:{}}),Object(L.a)(Object(A.a)(t.prototype),"initializeState",this).call(this)}},{key:"getShaders",value:function(){var e=!Object(k.f)(this.context.gl),a=this.props.modules,n=void 0===a?[]:a;return Object.assign({},Object(L.a)(Object(A.a)(t.prototype),"getShaders",this).call(this),{fs:"#version 300 es\n#define SHADER_NAME raster-mesh-layer-fs\n\nprecision highp float;\n\nuniform bool hasTexture;\n\nuniform bool flatShading;\nuniform float opacity;\n\nin vec2 vTexCoord;\nin vec3 cameraPosition;\nin vec3 normals_commonspace;\nin vec4 position_commonspace;\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  geometry.uv = vTexCoord;\n  vec4 image;\n  DECKGL_CREATE_COLOR(image, vTexCoord);\n\n  DECKGL_MUTATE_COLOR(image, vTexCoord);\n\n  vec3 normal;\n  if (flatShading) {\n\n// NOTE(Tarek): This is necessary because\n// headless.gl reports the extension as\n// available but does not support it in\n// the shader.\n#ifdef DERIVATIVES_AVAILABLE\n    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));\n#else\n    normal = vec3(0.0, 0.0, 1.0);\n#endif\n  } else {\n    normal = normals_commonspace;\n  }\n\n  vec3 lightColor = lighting_getLightColor(image.rgb, cameraPosition, position_commonspace.xyz, normal);\n  fragColor = vec4(lightColor, opacity);\n\n  DECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",transpileToGLSL100:e,modules:[G.a,N.b,U.a].concat(Object(R.a)(n))})}},{key:"updateState",value:function(e){var a=e.props,n=e.oldProps,r=e.changeFlags;if(Object(L.a)(Object(A.a)(t.prototype),"updateState",this).call(this,{props:a,oldProps:n,changeFlags:r}),a.mesh!==n.mesh||r.extensionsChanged||a.modules!==n.modules){if(this.state.model&&this.state.model.delete(),a.mesh){this.setState({model:this.getModel(a.mesh)});var o=a.mesh.attributes||a.mesh;this.setState({hasNormals:Boolean(o.NORMAL||o.normals)})}this.getAttributeManager().invalidateAll()}a&&a.images&&this.updateImages({props:a,oldProps:n}),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?h.a.LINE_STRIP:h.a.TRIANGLES)}},{key:"updateImages",value:function(e){var a=e.props,t=e.oldProps,n=this.state.images,r=function(e){var a=e.gl,t=e.images,n=e.props,r=e.oldProps,o=!1;if(r&&r.images)for(var i in r.images)n.images&&!(i in n.images)&&i in t&&(delete t[i],o=!0);var s=[];for(var c in n.images)!r.images||r.images&&!(c in r.images)?s.push(c):X()(n.images[c],r.images[c])||s.push(c);for(var l=0,m=s;l<m.length;l++){var u=m[l],p=n.images[u];p&&(Array.isArray(p)?t[u]=p.map((function(e){return q(a,e)})):t[u]=q(a,p),o=!0)}return o?t:null}({gl:this.context.gl,images:n,props:a,oldProps:t});r&&this.setState({images:r})}},{key:"draw",value:function(e){var a=e.uniforms,t=this.state,n=t.model,r=t.images,o=this.props.moduleProps;if(n&&r&&0!==Object.keys(r).length&&Object.values(r).every((function(e){return e}))){var i=this.context.viewport,s=this.props,c=s.sizeScale,l=s.coordinateSystem,m=s._instanced;n.setUniforms(Object.assign({},a,{sizeScale:c,composeModelMatrix:!m||B(i,l),flatShading:!this.state.hasNormals})).updateModuleSettings(Object(D.a)({},o,{},r)).draw()}}},{key:"finalizeState",value:function(){if(Object(L.a)(Object(A.a)(t.prototype),"finalizeState",this).call(this),this.state.images)for(var e=0,a=Object.values(this.state.images);e<a.length;e++){var n=a[e];Array.isArray(n)?n.map((function(e){return e.delete()})):n.delete()}}},{key:"getModel",value:function(e){var a=this.context.gl;return new I.a(a,Object.assign({},this.getShaders(),{id:this.props.id,geometry:$(e),isInstanced:!0}))}}]),t}(P.a);Y.layerName="RasterMeshLayer",Y.defaultProps=Q;function ee(e){var a="RGB".slice(0,e),t="gamma ".concat(a," 3.5, sigmoidal ").concat(a," 15 0.35");return 3===e&&(t+=", saturation 1.7"),t}function ae(e){var a=e.bands,t=e.url,n=e.x,r=e.y,o=e.z,i=Array.isArray(a)?a:[a],s={url:t,bands:i.join(","),color_ops:ee(i.length)},c=new URLSearchParams(s),l="https://us-west-2-lambda.kylebarron.dev/landsat/tiles/".concat(o,"/").concat(n,"/").concat(r,".jpg?");return l+=c.toString()}function te(e){var a=e.x,t=e.y,n=e.z;return"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png".replace("{x}",a).replace("{y}",t).replace("{z}",n)}var ne={rScaler:256,gScaler:1,bScaler:1/256,offset:-32768};function re(e){return 77067.34/(1<<e)}Object(b.b)([x.a]);var oe=[1];function ie(e){return se.apply(this,arguments)}function se(){return(se=Object(g.a)(d.a.mark((function e(a){var t,n,r,o,i,s,c,l,m,u,p,g,f,h,v;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.x,n=a.y,r=a.z,o=a.landsatBands,i=void 0===o?[5,4]:o,s=r>=12&&4===i[0]&&3===i[1]&&2===i[2],!0,"https://cdn.jsdelivr.net/gh/kylebarron/deck.gl-raster/assets/colormaps/spectral.png",c=[j,S],l=te({x:t,y:n,z:r}),m=me({terrainImage:l,bounds:[0,1,1,0],elevationDecoder:ne,meshMaxError:re(r)}),u=i.map((function(e){return ae({x:t,y:n,z:r,bands:e,url:"dynamodb://us-west-2/landsat8-2019-spring"})})),p=u.map((function(e){return ue(e)})),s&&(f=ae({x:t,y:n,z:r,bands:8,url:"dynamodb://us-west-2/landsat8-2019-spring"}),g=ue(f),c.push(C)),h=ue("https://cdn.jsdelivr.net/gh/kylebarron/deck.gl-raster/assets/colormaps/spectral.png"),c.push(w),e.next=14,Promise.all([g,p,h]);case 14:return e.next=16,Promise.all(p);case 16:return e.t0=e.sent,e.next=19,h;case 19:return e.t1=e.sent,e.next=22,g;case 22:return e.t2=e.sent,v={imageBands:e.t0,imageColormap:e.t1,imagePan:e.t2},e.t3=v,e.t4=c,e.next=28,m;case 28:return e.t5=e.sent,e.abrupt("return",{images:e.t3,modules:e.t4,terrain:e.t5});case 30:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ce(e){var a=e.data,t=e.tile;if(!a)return null;var n=a.images,r=a.modules,o=a.terrain;return[new Y(e,{data:oe,mesh:o,modules:r,images:n,getPolygonOffset:null,coordinateSystem:v.a.CARTESIAN,modelMatrix:le(t),getPosition:function(e){return[0,0,0]},getColor:[255,255,255]})]}function le(e){var a=Math.pow(2,e.z),t=512/a,n=-t,r=512*e.x/a,o=512*(1-e.y/a);return(new T.a).translate([r,o,0]).scale([t,n,1])}function me(e){var a=e.terrainImage,t=e.bounds,n=e.elevationDecoder,r=e.meshMaxError,o=e.workerUrl;if(!a)return null;var i={terrain:{bounds:t,meshMaxError:r,elevationDecoder:n}};return o&&(i.terrain.workerUrl=o),Object(_.a)(a,y.a,i)}function ue(e){return pe.apply(this,arguments)}function pe(){return(pe=Object(g.a)(d.a.mark((function e(a){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(_.a)(a,x.a);case 2:return t=e.sent,e.abrupt("return",{data:t,format:t&&10===t.height?h.a.RGB:h.a.LUMINANCE});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var de={latitude:46.21,longitude:-122.18,zoom:11.5,bearing:140,pitch:60,minZoom:7,maxPitch:80},ge=function(e){Object(m.a)(t,e);var a=Object(l.a)(t);function t(){return Object(s.a)(this,t),a.apply(this,arguments)}return Object(c.a)(t,[{key:"render",value:function(){var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=e.minZoom,t=void 0===a?7:a,n=e.maxZoom,r=void 0===n?12:n;return new O.a({id:"terrain-tiles",minZoom:t,maxZoom:r,tileSize:256,maxRequests:12,getTileData:ie,renderSubLayers:ce})}({minZoom:7,maxZoom:12});return r.a.createElement(u.a,{initialViewState:de,controller:!0,layers:e,glOptions:{powerPreference:"high-performance"}})}}]),t}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(ge,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[144,1,2]]]);
//# sourceMappingURL=main.b73af613.chunk.js.map