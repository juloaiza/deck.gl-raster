(this["webpackJsonpbands-bitmap-layer"]=this["webpackJsonpbands-bitmap-layer"]||[]).push([[0],{112:function(t,e){},149:function(t,e,a){t.exports=a(161)},154:function(t,e,a){},160:function(t,e){},161:function(t,e,a){"use strict";a.r(e);var n,r=a(9),i=a.n(r),o=a(128),s=a.n(o),l=(a(154),a(14)),u=a.n(l),p=a(27),c=a(2),m=a(1),b=a(72),_=a(5),d=a(0),g=a(174),h=a(179),T=a(175),f=a(134),v=a(3),x=a(16),y=a(28),E=a.n(y),j=a(180),O=a(77),C=(n={},Object(d.a)(n,E.a.TEXTURE_MIN_FILTER,E.a.LINEAR_MIPMAP_LINEAR),Object(d.a)(n,E.a.TEXTURE_MAG_FILTER,E.a.LINEAR),Object(d.a)(n,E.a.TEXTURE_WRAP_S,E.a.CLAMP_TO_EDGE),Object(d.a)(n,E.a.TEXTURE_WRAP_T,E.a.CLAMP_TO_EDGE),n),R=function(t){Object(_.a)(a,t);var e=Object(b.a)(a);function a(){return Object(c.a)(this,a),e.apply(this,arguments)}return Object(m.a)(a,[{key:"draw",value:function(t){var e=t.uniforms,a=this.state,n=a.bitmapTexture_r,r=a.bitmapTexture_g,i=a.bitmapTexture_b,o=a.model,s=this.props,l=s.desaturate,u=s.transparentColor,p=s.tintColor;n&&r&&i&&o&&o.setUniforms(Object.assign({},e,{bitmapTexture_r:n,bitmapTexture_g:r,bitmapTexture_b:i,desaturate:l,transparentColor:u.map((function(t){return t/255})),tintColor:p.slice(0,3).map((function(t){return t/255}))})).draw()}},{key:"finalizeState",value:function(){Object(x.a)(Object(v.a)(a.prototype),"finalizeState",this).call(this),this.state.bitmapTexture_r&&this.state.bitmapTexture_r.delete(),this.state.bitmapTexture_g&&this.state.bitmapTexture_g.delete(),this.state.bitmapTexture_b&&this.state.bitmapTexture_b.delete()}},{key:"getShaders",value:function(){return Object.assign({},Object(x.a)(Object(v.a)(a.prototype),"getShaders",this).call(this),{fs:"\n#define SHADER_NAME bands-bitmap-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D bitmapTexture_r;\nuniform sampler2D bitmapTexture_g;\nuniform sampler2D bitmapTexture_b;\n\nvarying vec2 vTexCoord;\n\nuniform float desaturate;\nuniform vec4 transparentColor;\nuniform vec3 tintColor;\nuniform float opacity;\n\n// apply desaturation\nvec3 color_desaturate(vec3 color) {\n  float luminance = (color.r + color.g + color.b) * 0.333333333;\n  return mix(color, vec3(luminance), desaturate);\n}\n\n// apply tint\nvec3 color_tint(vec3 color) {\n  return color * tintColor;\n}\n\n// blend with background color\nvec4 apply_opacity(vec3 color, float alpha) {\n  return mix(transparentColor, vec4(color, 1.0), alpha);\n}\n\nvoid main(void) {\n  float r_band = texture2D(bitmapTexture_r, vTexCoord).r;\n  float g_band = texture2D(bitmapTexture_g, vTexCoord).r;\n  float b_band = texture2D(bitmapTexture_b, vTexCoord).r;\n  vec4 image = vec4(r_band, g_band, b_band, 1.);\n\n  gl_FragColor = apply_opacity(color_tint(color_desaturate(image.rgb)), image.a * opacity);\n\n  geometry.uv = vTexCoord;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n"})}},{key:"updateState",value:function(t){var e=t.props,a=t.oldProps;if(t.changeFlags.extensionsChanged){var n=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(n)}),this.getAttributeManager().invalidateAll()}if(e.image_r!==a.image_r){var r=this.loadTexture(e.image_r);this.state.bitmapTexture_r&&this.state.bitmapTexture_r.delete(),this.setState({bitmapTexture_r:r})}if(e.image_g!==a.image_g){var i=this.loadTexture(e.image_g);this.state.bitmapTexture_g&&this.state.bitmapTexture_g.delete(),this.setState({bitmapTexture_g:i})}if(e.image_b!==a.image_b){var o=this.loadTexture(e.image_b);this.state.bitmapTexture_b&&this.state.bitmapTexture_b.delete(),this.setState({bitmapTexture_b:o})}var s=this.getAttributeManager();e.bounds!==a.bounds&&s.invalidate("positions")}},{key:"loadTexture",value:function(t){var e=this.context.gl;return t instanceof O.a?t:t instanceof HTMLVideoElement?{bitmapTexture:new O.a(e,{width:1,height:1,parameters:C,mipmaps:!1})}:t?{bitmapTexture:new O.a(e,{data:t,parameters:C})}:void 0}}]),a}(j.a);R.defaultProps={image_r:{type:"object",value:null,async:!0},image_g:{type:"object",value:null,async:!0},image_b:{type:"object",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]}},R.layerName="BandsBitmapLayer";var A,w=(A={},Object(d.a)(A,E.a.TEXTURE_MIN_FILTER,E.a.LINEAR_MIPMAP_LINEAR),Object(d.a)(A,E.a.TEXTURE_MAG_FILTER,E.a.LINEAR),Object(d.a)(A,E.a.TEXTURE_WRAP_S,E.a.CLAMP_TO_EDGE),Object(d.a)(A,E.a.TEXTURE_WRAP_T,E.a.CLAMP_TO_EDGE),A),L=function(t){Object(_.a)(a,t);var e=Object(b.a)(a);function a(){return Object(c.a)(this,a),e.apply(this,arguments)}return Object(m.a)(a,[{key:"draw",value:function(t){var e=t.uniforms,a=this.state,n=a.bitmapTexture_r,r=a.bitmapTexture_g,i=a.bitmapTexture_b,o=a.bitmapTexture_pan,s=a.model,l=this.props,u=l.desaturate,p=l.transparentColor,c=l.tintColor,m=l.panWeight;n&&r&&i&&o&&s&&s.setUniforms(Object.assign({},e,{bitmapTexture_r:n,bitmapTexture_g:r,bitmapTexture_b:i,bitmapTexture_pan:o,panWeight:m,desaturate:u,transparentColor:p.map((function(t){return t/255})),tintColor:c.slice(0,3).map((function(t){return t/255}))})).draw()}},{key:"finalizeState",value:function(){Object(x.a)(Object(v.a)(a.prototype),"finalizeState",this).call(this),this.state.bitmapTexture_r&&this.state.bitmapTexture_r.delete(),this.state.bitmapTexture_g&&this.state.bitmapTexture_g.delete(),this.state.bitmapTexture_b&&this.state.bitmapTexture_b.delete(),this.state.bitmapTexture_pan&&this.state.bitmapTexture_pan.delete()}},{key:"getShaders",value:function(){return Object.assign({},Object(x.a)(Object(v.a)(a.prototype),"getShaders",this).call(this),{fs:"\n#define SHADER_NAME bands-bitmap-layer-pan-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D bitmapTexture_r;\nuniform sampler2D bitmapTexture_g;\nuniform sampler2D bitmapTexture_b;\nuniform sampler2D bitmapTexture_pan;\n\nvarying vec2 vTexCoord;\n\nuniform float desaturate;\nuniform vec4 transparentColor;\nuniform vec3 tintColor;\nuniform float opacity;\nuniform float panWeight;\n\n\n// calculate pansharpen ratio\nfloat pansharpen_ratio(vec3 rgb, float pan, float weight) {\n    return pan / ((rgb.r + rgb.g + rgb.b * weight) / (2. + weight));\n}\n\n// Brovey Method: Each resampled, multispectral pixel is\n// multiplied by the ratio of the corresponding\n// panchromatic pixel intensity to the sum of all the\n// multispectral intensities.\n// Original code from https://github.com/mapbox/rio-pansharpen\nvec3 pansharpen(vec3 rgb, float pan, float weight) {\n    float ratio = pansharpen_ratio(rgb, pan, weight);\n    vec3 alteredRGB = ratio * rgb;\n    return clamp(alteredRGB, 0., 1.);\n}\n\n// apply desaturation\nvec3 color_desaturate(vec3 color) {\n  float luminance = (color.r + color.g + color.b) * 0.333333333;\n  return mix(color, vec3(luminance), desaturate);\n}\n\n// apply tint\nvec3 color_tint(vec3 color) {\n  return color * tintColor;\n}\n\n// blend with background color\nvec4 apply_opacity(vec3 color, float alpha) {\n  return mix(transparentColor, vec4(color, 1.0), alpha);\n}\n\nvoid main(void) {\n  float r_band = texture2D(bitmapTexture_r, vTexCoord).r;\n  float g_band = texture2D(bitmapTexture_g, vTexCoord).r;\n  float b_band = texture2D(bitmapTexture_b, vTexCoord).r;\n  float pan_band = texture2D(bitmapTexture_pan, vTexCoord).r;\n  vec3 image = vec3(r_band, g_band, b_band);\n\n  vec3 pansharpenedImage = pansharpen(image, pan_band, panWeight);\n\n  gl_FragColor = apply_opacity(color_tint(color_desaturate(pansharpenedImage)), opacity);\n\n  geometry.uv = vTexCoord;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n"})}},{key:"updateState",value:function(t){var e=t.props,a=t.oldProps;if(t.changeFlags.extensionsChanged){var n=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(n)}),this.getAttributeManager().invalidateAll()}if(e.image_r!==a.image_r){var r=this.loadTexture(e.image_r);this.state.bitmapTexture_r&&this.state.bitmapTexture_r.delete(),this.setState({bitmapTexture_r:r})}if(e.image_g!==a.image_g){var i=this.loadTexture(e.image_g);this.state.bitmapTexture_g&&this.state.bitmapTexture_g.delete(),this.setState({bitmapTexture_g:i})}if(e.image_b!==a.image_b){var o=this.loadTexture(e.image_b);this.state.bitmapTexture_b&&this.state.bitmapTexture_b.delete(),this.setState({bitmapTexture_b:o})}if(e.image_pan!==a.image_pan){var s=this.loadTexture(e.image_pan);this.state.bitmapTexture_pan&&this.state.bitmapTexture_pan.delete(),this.setState({bitmapTexture_pan:s})}var l=this.getAttributeManager();e.bounds!==a.bounds&&l.invalidate("positions")}},{key:"loadTexture",value:function(t){var e=this.context.gl;return t instanceof O.a?t:t instanceof HTMLVideoElement?{bitmapTexture:new O.a(e,{width:1,height:1,parameters:w,mipmaps:!1})}:t?{bitmapTexture:new O.a(e,{data:t,parameters:w})}:void 0}}]),a}(j.a);L.defaultProps={image_r:{type:"object",value:null,async:!0},image_g:{type:"object",value:null,async:!0},image_b:{type:"object",value:null,async:!0},image_pan:{type:"object",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},desaturate:{type:"number",min:0,max:1,value:0},panWeight:{type:"number",min:0,max:1,value:.2},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]}},L.layerName="BandsBitmapLayer";var S,M=a(177),I=a(173),D=(S={},Object(d.a)(S,E.a.TEXTURE_MIN_FILTER,E.a.LINEAR_MIPMAP_LINEAR),Object(d.a)(S,E.a.TEXTURE_MAG_FILTER,E.a.LINEAR),Object(d.a)(S,E.a.TEXTURE_WRAP_S,E.a.CLAMP_TO_EDGE),Object(d.a)(S,E.a.TEXTURE_WRAP_T,E.a.CLAMP_TO_EDGE),S),P={longitude:-112.1861,latitude:36.1284,zoom:10.1,pitch:0,bearing:0},k="s3://kylebarron-landsat-test/mosaics/8113f57876010a63aadacef4eac6d010d10c9aafcf36a5ece064ea7f.json.gz";function G(t){var e="RGB".slice(0,t),a="gamma ".concat(e," 3.5, sigmoidal ").concat(e," 15 0.35");return 3===t&&(a+=", saturation 1.7"),a}function N(t){var e=t.bands,a=t.url,n=t.x,r=t.y,i=t.z,o=Array.isArray(e)?e:[e],s={url:a,bands:o.join(","),color_ops:G(o.length)},l=new URLSearchParams(s),u="https://landsat-lambda.kylebarron.dev/tiles/".concat(i,"/").concat(n,"/").concat(r,"@2x.jpg?");return u+=l.toString()}var U=new h.a(I.a,{amount:1}),z=function(t){Object(_.a)(a,t);var e=Object(b.a)(a);function a(){var t;Object(c.a)(this,a);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))).state={gl:null},t}return Object(m.a)(a,[{key:"render",value:function(){var t=this,e=[new T.a({minZoom:0,maxZoom:12,getTileData:function(){var e=Object(p.a)(u.a.mark((function e(a){var n,r,i,o,s,l,p,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.x,r=a.y,i=a.z,o=t.state.gl,s=i>=12,l=[N({x:n,y:r,z:i,bands:4,url:k}),N({x:n,y:r,z:i,bands:3,url:k}),N({x:n,y:r,z:i,bands:2,url:k})],s&&l.push(N({x:n,y:r,z:i,bands:8,url:k})),e.next=7,Object(M.a)(l.length,(function(t){var e=t.index;return l[e]}));case 7:return p=e.sent,c=p.map((function(t){return new O.a(o,{data:t,parameters:D,format:E.a.RGB})})),e.abrupt("return",c);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),renderSubLayers:function(t){var e,a,n,r,i=t.tile,o=i.bbox,s=o.west,l=o.south,u=o.east,p=o.north,c=i.z,m=t.data,b=c>=12;return Array.isArray(m)?(e=m[0],a=m[1],n=m[2],b&&(r=m[3])):m&&(e=m.then((function(t){return t&&t[0]})),a=m.then((function(t){return t&&t[1]})),n=m.then((function(t){return t&&t[2]})),b&&(r=m.then((function(t){return t&&t[3]})))),b?new L(t,{data:null,image_r:e,image_g:a,image_b:n,image_pan:r,bounds:[s,l,u,p]}):new R(t,{data:null,image_r:e,image_g:a,image_b:n,bounds:[s,l,u,p]})}})];return i.a.createElement(g.a,{onWebGLInitialized:function(e){return t.setState({gl:e})},initialViewState:P,layers:e,effects:[U],controller:!0},i.a.createElement(f.a,{mapStyle:"https://cdn.jsdelivr.net/gh/nst-guide/osm-liberty-topo@gh-pages/style.json",mapOptions:{hash:!0}}))}}]),a}(i.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(z,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[149,1,2]]]);
//# sourceMappingURL=main.11e7da58.chunk.js.map